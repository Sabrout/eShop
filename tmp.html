<html>
<head>
	<meta charset="UTF-8">
  <title>eShop</title>
  <link rel="stylesheet" href="CSS/style.css">
</head>
<body>
	<header class="header">
      <h1 class="logo">Logo</h1>
      <ul class="nav">
        <li><a href="#">Shopping Cart</a></li>
        <li><a href="Register.php">Register</a></li>
        <li><a href="#">Sign in</a></li>
      </ul>
  </header>

  <div id="backgroundOverlay">
    <div id="login">
    <h1 id="CreateAccount">Create Account</h1>
      <form action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]);?>" method="POST">
        <input type="text" placeholder="First Name" id="topText" required name="fname" />
        <input type="text" placeholder="Last Name" id="textBox" required name="lname"/>
        <input type="text" placeholder="Email" id="textBox" required name="email"/>
        <input type="password" placeholder="Password" id="textBox" required name="password"/>
        <input type="password" placeholder="Confirm password" id="botText" required/>
<!--         <input type="file" name="image"> -->
<!-- enctype="multipart/form-data" -->
        <input type="submit" id="loginButton" value="Sign up" name="submit"></input>
        <a href="Default.php">Already an account? <b>Login!</b></a>
      </form>      
    </div>
  </div>
  <?php
    if (isset($POST['submit'])) {
      // Create connection
      $conn = mysqli_connect("localhost", "root", "", "eshop");
      // Check connection
      if (!$conn) {
        die("Connection failed: " . mysqli_connect_error());
      }

      echo "Test";

      // define variables and set to empty values
      $fname = $lname = $email = $password = "";

      if ($_SERVER["REQUEST_METHOD"] == "POST") {
        $fname = test_input($_POST["fname"]);
        $lname = test_input($_POST["lname"]);
        $email = test_input($_POST["email"]);
        $password = test_input($_POST["password"]);
        }

      function test_input($data) {
        $data = trim($data);
        $data = stripslashes($data);
        $data = htmlspecialchars($data);
        return $data;
      }

      $imageName = mysql_real_escape_string($_FILES["image"]["name"]);
      $imageData = mysql_real_escape_string(file_get_contents($_FILES["image"]["tmp_name"]));
      $imageType = mysql_real_escape_string($_FILES["image"]["type"]);
      //echo $imageData;

      echo "before";
      echo substr($imageName, -3);

      // if (substr($imageName, -3) == "jpg" || substr($imageName, -3) == "png") {
        echo "Doing";
        $sql = "INSERT INTO users (fname, lname, email, password, avatar)
        VALUES ('$fname', '$lname', '$email', '$password', null)";
        echo "Done!!!";

        if ($conn->query($sql) === TRUE) {
          echo "New record created successfully";
          } else {
            echo "Error: " . $sql . "<br>" . $conn->error;
            }
        // }else{
        //   echo "Wrong Image Extension";
        // }      
    }
    
  ?>

</body>
</html>